id: twitter
label: Migrate twitter feed into Drupal nodes
migration_group: social_networks
source:
  plugin: social_network
  track_changes: true
  social_network_plugin: twitter
destination:
  plugin: entity:node

process:
  # Note that the source field names here (machine_name and friendly_name) were
  # defined by the 'fields' configuration for the source plugin above.
  id: id
  title: id
  'body/value':
    plugin: callback
    source: full_text
    callable: html_entity_decode
  'body/format':
    plugin: default_value
    default_value: plain_text
  created:
    plugin: callback
    source: created_at
    callable: strtotime

  # Hardcode the destination node type.
  type:
    plugin: default_value
    default_value: social

  # Hardcode the social type.
  field_social_type:
    plugin: default_value
    default_value: twitter

  # Twiiter return or null or array in array.
  field_media:
    - plugin: iterator
      source: extended_entities
      process:
        media:
          plugin: get
          source: '0'

    - plugin: extract
      default: ''
      index:
        - media
        - media
        - media_url

  # TODO Temp value to insert it with @ below, may be can do it better.
  temp_twitter_link:
    - plugin: default_value
      default_value: 'https://twitter.com/P4HNetwork/status/'

  field_permalink_url:
    - plugin: get
      source:
        - '@temp_twitter_link'
        - id_str
    - plugin: concat

dependencies:
  enforced:
    module:
      - migrate_social_implementation
